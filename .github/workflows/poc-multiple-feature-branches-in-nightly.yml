name: Nightly Build for All Present Feature Branches

on:
  schedule:
    - cron: '50 11 * * *'
  workflow_dispatch:

jobs:
  fetch-branches:
    runs-on: ubuntu-latest
    outputs:
      branches: ${{ steps.get-branches.outputs.branches }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Get feature branches
        id: get-branches
        run: |
          BRANCHES=$(git ls-remote --heads origin | awk -F'/' '{print $3}' | grep '^feature-' | jq -R -s -c 'split("\n")[:-1]')
          echo "branches=$BRANCHES" >> $GITHUB_ENV
          echo "::set-output name=branches::$BRANCHES"

  build:
    needs: fetch-branches
    runs-on: ubuntu-latest
    strategy:
      matrix:
        branch: ${{ fromJson(needs.fetch-branches.outputs.branches) }}
    steps:
      - name: Checkout branch ${{ matrix.branch }}
        uses: actions/checkout@v4
        with:
          ref: ${{ matrix.branch }}
      
      - name: Run build script
        run: |
          echo "Building branch ${{ matrix.branch }}"
          # Add build commands here
